
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://kameshsampath.github.com/gloo-edge-gitops-quickstart/env-setup/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
      
        <title>Envrionment Setup - Gloo Edge GitOps Quickstart</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Red+Hat+Display:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font:"Red Hat Display";--md-code-font:""}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ansible-environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Gloo Edge GitOps Quickstart" class="md-header__button md-logo" aria-label="Gloo Edge GitOps Quickstart" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gloo Edge GitOps Quickstart
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Envrionment Setup
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Gloo Edge GitOps Quickstart" class="md-nav__button md-logo" aria-label="Gloo Edge GitOps Quickstart" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Gloo Edge GitOps Quickstart
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tools-and-sources/" class="md-nav__link">
        Get Started
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Environment Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Environment Setup
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ansible-environment" class="md-nav__link">
    Ansible Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-environment" class="md-nav__link">
    Demo Environment
  </a>
  
    <nav class="md-nav" aria-label="Demo Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ansible-variables-file" class="md-nav__link">
    Ansible Variables File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quickstart-varsyml" class="md-nav__link">
    Quickstart vars.yml
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-kubernetes-clusters" class="md-nav__link">
    Setup Kubernetes Clusters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-gitea" class="md-nav__link">
    Deploy Gitea
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-argocd" class="md-nav__link">
    Deploy Argocd
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-pipelines" class="md-nav__link">
    Deploy Pipelines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-gloo-edge" class="md-nav__link">
    Deploy Gloo Edge
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../gitops/" class="md-nav__link">
        GitOps Examples
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../clean-up/" class="md-nav__link">
        Clean Up
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Appendix
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Appendix" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Appendix
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ansible/" class="md-nav__link">
        Ansible Roles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ansible-environment" class="md-nav__link">
    Ansible Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-environment" class="md-nav__link">
    Demo Environment
  </a>
  
    <nav class="md-nav" aria-label="Demo Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ansible-variables-file" class="md-nav__link">
    Ansible Variables File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quickstart-varsyml" class="md-nav__link">
    Quickstart vars.yml
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-kubernetes-clusters" class="md-nav__link">
    Setup Kubernetes Clusters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-gitea" class="md-nav__link">
    Deploy Gitea
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-argocd" class="md-nav__link">
    Deploy Argocd
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-pipelines" class="md-nav__link">
    Deploy Pipelines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-gloo-edge" class="md-nav__link">
    Deploy Gloo Edge
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>Environment Setup</h1>

<p>At the end of this chapter you would have,</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Ansible environment to run the playbooks</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Two Kubernetes Clusters  mgmt and cluster1 on minikube</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Argocd and Gitea will be installed into <strong>mgmt</strong> cluster</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> <strong>cluster1</strong> will act as application workload with Gloo Edge and Portal, Pipelines are installed as part of the setup</li>
</ul>
<h2 id="ansible-environment">Ansible Environment<a class="headerlink" href="#ansible-environment" title="Permanent link">&para;</a></h2>
<p>To create the virutal environment run the following command,</p>
<div class="highlight"><pre><span></span><code>make create-venv
</code></pre></div>
<p>The command will instal all the required python modules in the <code>$DEMO_HOME/.venv</code>.</p>
<p>Install the <a href="../ansible/">ansible roles and collections</a> that will be used by the playbooks,</p>
<div class="highlight"><pre><span></span><code>make install-roles-and-collections
</code></pre></div>
<h2 id="demo-environment">Demo Environment<a class="headerlink" href="#demo-environment" title="Permanent link">&para;</a></h2>
<p>The following tables shows the environment to component matrix.</p>
<table>
<thead>
<tr>
<th>Components</th>
<th>mgmt</th>
<th>cluster1</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kubernetes</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 7 9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg></span></td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 7 9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg></span></td>
</tr>
<tr>
<td>Kubernetes Context Name</td>
<td>mgmt</td>
<td>cluster1</td>
</tr>
<tr>
<td>Argocd</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 7 9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg></span></td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></td>
</tr>
<tr>
<td>Gitea</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 7 9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg></span></td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></td>
</tr>
<tr>
<td>Gloo Edge</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 7 9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg></span></td>
</tr>
<tr>
<td>Gloo Portal</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 7 9 19l-5.5-5.5 1.41-1.41L9 16.17 19.59 5.59 21 7z"/></svg></span></td>
</tr>
</tbody>
</table>
<p>Navigate to the <code>$DEMO_HOME</code>,</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="nv">$DEMO_HOME</span>
</code></pre></div>
<h3 id="ansible-variables-file">Ansible Variables File<a class="headerlink" href="#ansible-variables-file" title="Permanent link">&para;</a></h3>
<p>All Ansible variables used in this quickstart is configured using the file <code>$DEMO_HOME/vars.yml</code>, be sure edit them suit your settings.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>work_dir</code></td>
<td>The demo work directory</td>
<td><code>{{ playbook_dir }}/work</code>. Any file in this diectory is excluded by git.</td>
</tr>
<tr>
<td><code>kubeconfig_dir</code></td>
<td>The directory where the kubeconfig files the minikube clusters will be stored.</td>
<td><code>{{ work_dir }}/.kube</code>. Any file in this diectory is excluded by git.</td>
</tr>
<tr>
<td><code>minikube_kubernetes_version</code></td>
<td>The kubernetes version to use with minikube</td>
<td>v1.21.6</td>
</tr>
<tr>
<td><code>minikube_home_dir</code></td>
<td>The minikube home directory</td>
<td><code>{{ work_dir }}/.minikube</code></td>
</tr>
<tr>
<td><code>helm_version</code></td>
<td>The helm.sh version to use</td>
<td>3.7.1</td>
</tr>
<tr>
<td><code>helm_secrets_plugin_version</code></td>
<td>The helm secerts plugin version . This is just added to enable using Helm Secrets</td>
<td>3.10.0</td>
</tr>
<tr>
<td><code>sops_version</code></td>
<td>The sops version. This added to be used with Helm Secrets</td>
<td>3.7.1</td>
</tr>
<tr>
<td><code>kubectl_version</code></td>
<td>The kubectl version</td>
<td>1.21.6</td>
</tr>
<tr>
<td><code>gitea_tls_cert_path</code></td>
<td>The self signed certified to use with gitea</td>
<td><code>{{ work_dir}}/ssl/gitea-tls.crt</code></td>
</tr>
<tr>
<td><code>kubernetes_spices_gitea_k8s_context</code></td>
<td>The kubernetetes context where Gitea will be installed</td>
<td><code>mgmt</code></td>
</tr>
<tr>
<td><code>kubernetes_spices_argocd_k8s_context</code></td>
<td>The kubernetetes context where Argocd will be installed</td>
<td><code>mgmt</code></td>
</tr>
<tr>
<td><code>kubernetes_spices_tektoncd_k8s_context</code></td>
<td>The kubernetetes context where tektoncd will be installed</td>
<td><code>mgmt</code></td>
</tr>
<tr>
<td><code>enable_portal_monetization</code></td>
<td>Enabe Portal monetization</td>
<td><code>yes</code></td>
</tr>
</tbody>
</table>
<p>The <code>minikube_profiles</code> defines the minikube cluster(s) that will be created for the demo environment,</p>
<div class="highlight"><pre><span></span><code><span class="nt">minikube_profiles</span><span class="p">:</span>
  <span class="c1"># minikube profile name and the same will used the k8s context name for this cluster</span>
  <span class="nt">mgmt</span><span class="p">:</span>
    <span class="c1"># The create minikube</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="c1"># The destory minikube</span>
    <span class="nt">destroy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="c1"># The minikube addons to configure</span>
    <span class="nt">addons</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">metallb</span>
    <span class="c1"># the metallb LoadBalancer Start IP</span>
    <span class="nt">lbStartIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.80</span>
    <span class="c1"># the metallb LoadBalancer End IP</span>
    <span class="nt">lbEndIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.90</span>
  <span class="nt">cluster1</span><span class="p">:</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="nt">destroy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">addons</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">metallb</span>
    <span class="nt">lbStartIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.100</span>
    <span class="nt">lbEndIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.110</span>
  <span class="nt">cluster2</span><span class="p">:</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">destroy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">addons</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">metallb</span>
    <span class="nt">lbStartIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.120</span>
    <span class="nt">lbEndIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.130</span>
</code></pre></div>
<p>For more information on the variables check the Ansible role <a href="https://kameshsampath.github.io/ansible-role-minikube/" target="_blank">minikube</a>.</p>
<p>The <code>gloo_clusters</code> variable by default has the following values, refer to the <a href="./#demo-environment">component matrix</a> above to understand what this dictionary key/value represents.</p>
<div class="highlight"><pre><span></span><code><span class="nt">gloo_clusters</span><span class="p">:</span>
  <span class="nt">cluster1</span><span class="p">:</span>
    <span class="nt">cloud</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minikube</span>
    <span class="nt">k8s_context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster1</span>
    <span class="nt">install_istio</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="nt">cluster_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster1</span>
    <span class="nt">enable_portal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div>
<h2 id="quickstart-varsyml">Quickstart <code>vars.yml</code><a class="headerlink" href="#quickstart-varsyml" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># the demo work directory</span>
<span class="nt">work_dir</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/work&quot;</span>
<span class="c1"># the kubeconfig directory</span>
<span class="nt">kubeconfig_dir</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">work_dir</span><span class="nv"> </span><span class="s">}}/.kube&quot;</span>
<span class="c1"># the kubernetes version to use with minikube</span>
<span class="nt">minikube_kubernetes_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1.21.6</span>
<span class="c1"># the minikube home directory</span>
<span class="nt">minikube_home_dir</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">work_dir</span><span class="nv"> </span><span class="s">}}/.minikube&quot;</span>
<span class="c1"># the helm.sh version to use</span>
<span class="nt">helm_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3.7.1</span>
<span class="c1"># the kubectl version</span>
<span class="nt">kubectl_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.21.6</span>

<span class="c1"># minikube Kubernetes Clusters</span>
<span class="nt">minikube_profiles</span><span class="p">:</span>
  <span class="c1"># cluster where management and infrastructure components are deployed</span>
  <span class="c1"># e.g. gitea, argocd</span>
  <span class="nt">mgmt</span><span class="p">:</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="nt">destroy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">addons</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">metallb</span>
    <span class="nt">lbStartIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.80</span>
    <span class="nt">lbEndIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.90</span>
  <span class="nt">cluster1</span><span class="p">:</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="nt">destroy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">addons</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">metallb</span>
    <span class="nt">lbStartIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.100</span>
    <span class="nt">lbEndIP</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.64.110</span>
<span class="c1"># Gloo Edge Kubernetes clusters</span>
<span class="nt">gloo_clusters</span><span class="p">:</span>
  <span class="nt">cluster1</span><span class="p">:</span>
    <span class="nt">cloud</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minikube</span>
    <span class="nt">k8s_context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster1</span>
    <span class="nt">cluster_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster1</span>
    <span class="nt">enable_portal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="nt">enable_portal_monetization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="nt">kubernetes_spices_argocd_k8s_context</span><span class="p">:</span> <span class="s">&quot;mgmt&quot;</span>
<span class="nt">kubernetes_spices_tektoncd_k8s_context</span><span class="p">:</span> <span class="s">&quot;cluster1&quot;</span>

<span class="c1"># Gitea</span>
<span class="nt">kubernetes_spices_gitea_k8s_context</span><span class="p">:</span> <span class="s">&quot;mgmt&quot;</span>
<span class="nt">gitea_tls_cert_path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">work_dir}}/ssl/gitea-tls.crt&quot;</span>
</code></pre></div>
<h2 id="setup-kubernetes-clusters">Setup Kubernetes Clusters<a class="headerlink" href="#setup-kubernetes-clusters" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>make create-kube-clusters
</code></pre></div>
<p>The task creates the kubernetes clusters configured using <code>minikube_profiles</code> and also downloads the compatible tools to <code>$DEMO_HOME/bin</code>.</p>
<p>Add the <code>$DEMO_HOME/bin</code> to your path to make sure the right versions of the tools are used,</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$DEMO_HOME</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When you have <code>metallb</code> addon enabled it will be required for you to configure the addon using minikube. As matter of convinice you can add the following tasks to the clusters playbook to make ansible do it for you</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">tasks</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;Configure</span><span class="nv"> </span><span class="s">metallb&quot;</span>
  <span class="nt">ansible.builtin.expect</span><span class="p">:</span>
    <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">minikube_binary</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-p</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">addons</span><span class="nv"> </span><span class="s">configure</span><span class="nv"> </span><span class="s">metallb&quot;</span>
    <span class="nt">responses</span><span class="p">:</span>
      <span class="s">&quot;--</span><span class="nv"> </span><span class="s">Enter</span><span class="nv"> </span><span class="s">Load</span><span class="nv"> </span><span class="s">Balancer</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">IP:&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.value.lbStartIP}}&quot;</span>
      <span class="s">&quot;--</span><span class="nv"> </span><span class="s">Enter</span><span class="nv"> </span><span class="s">Load</span><span class="nv"> </span><span class="s">Balancer</span><span class="nv"> </span><span class="s">End</span><span class="nv"> </span><span class="s">IP:&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.value.lbEndIP}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">minikube_profiles</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">dict2items</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop_control</span><span class="p">:</span>
     <span class="nt">label</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb_setup_result</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item.value.create and not item.value.destroy</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;Metallb</span><span class="nv"> </span><span class="s">result&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb_setup_result</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<h2 id="deploy-gitea">Deploy Gitea<a class="headerlink" href="#deploy-gitea" title="Permanent link">&para;</a></h2>
<p>Deploy minkube hosted <a href="https://gitea.io">Gitea</a> git repository for working with GitOps,</p>
<div class="highlight"><pre><span></span><code>make deploy-gitea
</code></pre></div>
<h2 id="deploy-argocd">Deploy Argocd<a class="headerlink" href="#deploy-argocd" title="Permanent link">&para;</a></h2>
<p>Deploy <a href="https://argoproj.github.io">argocd</a> for enabling continious delivery using GitOps,</p>
<div class="highlight"><pre><span></span><code>make deploy-argocd
</code></pre></div>
<h2 id="deploy-pipelines">Deploy Pipelines<a class="headerlink" href="#deploy-pipelines" title="Permanent link">&para;</a></h2>
<p>Deploy <a href="https://tekton.dev">tektoncd</a> for enabling Kubernetes native pipelines,</p>
<div class="highlight"><pre><span></span><code>make deploy-pipelines
</code></pre></div>
<h2 id="deploy-gloo-edge">Deploy Gloo Edge<a class="headerlink" href="#deploy-gloo-edge" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>make deploy-gloo
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../tools-and-sources/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Get Started" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Get Started
            </div>
          </div>
        </a>
      
      
        
        <a href="../gitops/" class="md-footer__link md-footer__link--next" aria-label="Next: GitOps Examples" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              GitOps Examples
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.tabs.link"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>